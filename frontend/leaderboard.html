<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Leaderboard</title>
  </head>
  <body>
    <h1>Challenge Leaderboard</h1>
    <label>Enter score: <input id="score" type="number" /></label>
    <button id="submit">Submit</button>
    <h2>Top Scores</h2>
    <ol id="scoresList"></ol>

    <script type="module">
      const SUPABASE_URL = "https://your-supabase-url.supabase.co";
      const SUPABASE_ANON_KEY = "your-anon-key";
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      async function loadTop() {
        const { data } = await supabase
          .from("challenge_scores")
          .select("*")
          .order("score", { ascending: false })
          .limit(10);
        const list = document.getElementById("scoresList");
        list.innerHTML = "";
        data.forEach((r) => {
          const li = document.createElement("li");
          li.textContent = `${r.user_id || "anon"} â€” ${r.score}`;
          list.appendChild(li);
        });
      }
      loadTop();

      // realtime subscribe to new scores
      supabase
        .from("challenge_scores")
        .on("INSERT", (_) => loadTop())
        .subscribe();

      document.getElementById("submit").onclick = async () => {
        const s = parseFloat(document.getElementById("score").value);
        if (isNaN(s)) return alert("Enter a number");
        const { error } = await supabase
          .from("challenge_scores")
          .insert([{ user_id: null, score: s }]);
        if (error) return alert("Failed: " + error.message);
        document.getElementById("score").value = "";
      };
    </script>
  </body>
</html>
